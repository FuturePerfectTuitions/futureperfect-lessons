<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Future Perfect – Lessons</title>

  <style>
    body{font-family:"Segoe UI",Arial,sans-serif;background:#fff;padding:24px;}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid #ccc;font-weight:700;cursor:pointer;}
    .primary{background:#0b2a6f;color:#fff;border:none;}
  </style>
</head>

<body>
  <h1 id="heading">Lessons</h1>

  <div>
    <a href="chooser.html" class="btn">← Change year</a>
    <button id="logoutBtn" class="btn primary">Log out</button>
  </div>

  <div id="list"></div>

<script>
  const API = "https://fpt-lessons-api.futureperfectlessons.workers.dev";
  const year = new URLSearchParams(location.search).get("year");

  function logout(){
    sessionStorage.clear();
    location.href = "index.html";
  }

  function getAuth(){
    const u = sessionStorage.getItem("fpt_u");
    const p = sessionStorage.getItem("fpt_p");
    if(!u || !p) return null;
    return { header: "Basic " + btoa(u + ":" + p) };
  }

  async function load(){
    const auth = getAuth();
    if(!auth){ location.href = "index.html"; return; }

    document.getElementById("logoutBtn").onclick = logout;

    const lessons = await fetch(`${API}/lessons?year=${year}`, {
      headers:{ Authorization: auth.header }
    }).then(r => r.json());

    const list = document.getElementById("list");
    lessons.forEach(l => {
      const div = document.createElement("div");
      div.textContent = l.title;
      list.appendChild(div);
    });
  }

  load();
</script>
</body>
</html>
